define("wkview:widget/common_toc_reader/reader_xreader/index.js",function(e,t,o){var n=e("wkcommon:widget/lib/tangram/base/base.js"),r=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,i=e("wkcommon:widget/ui/js_core/log/log.js"),a=e("wkcommon:widget/ui/js_core/util/util.js"),s=e("wkcommon:widget/lib/fis/data/data.js"),d=e("wkcommon:widget/ui/js_core/xform/xform.js"),g=e("wkcommon:widget/ui/js_core/login/login.js"),c=e("wkview:widget/common_toc_toolbar/item/zoom/zoom.js").zoom,l=e("wkview:widget/common_toc_toolbar/item/fullScreen/fullScreen.js").fullScreen,p=e("wkview:widget/common_toc_toolbar/item/page/page.js").page,w=e("wkview:widget/common_toc_toolbar/item/praise/praise.js").praise,f=e("wkview:widget/common_toc_toolbar/item/favo/favo.js").favo,v=e("wkview:widget/common_toc_toolbar/item/wangpan/wangpan.js").wangpan,u=e("wkview:widget/common_toc_toolbar/item/convert/convert.js").convert,m=e("wkview:widget/common_toc_toolbar/item/appraise/appraise.js").appraise,h=e("wkview:widget/common_toc_toolbar/toolbar/toolbar.js").toolbar,_=e("wkview:widget/common_toc_toolbar/item/coreBtns/coreBtns.js").coreBtns,C=e("wkview:widget/common_toc_toolbar/item/share/share.js").share,P=e("wkview:widget/common_item/autofixed/autofixed.js").autofixed,S=e("wkview:widget/common_item/topMessage/topMessage.js").topMessage,b=e("wkview:widget/common_toc_toolbar/config.js").config,k=e("wkview:widget/common_item/setting/setting.js").setting,x=e("wkview:widget/ui/view/down_wangpan/down_doc.js").downDocCreate(),T=e("wkview:widget/ui/view/down_doc/down_doc.js").downDocCreate(),R=e("wkcommon:widget/ui/lib/cookie/cookie.js"),j=e("wkcommon:widget/performance/performance.js"),y=e("wkview:widget/model/vipData.js"),L=0,E=s.get("WkInfo"),z=E.DocInfo,O=E.UserInfo||{},B=r({Options:{el:"",doc_id:"",doc_id_update:"",docType:"doc",isLogin:0,zoomLevel:1,startPage:51,pageCount:100},_init:function(){var e=this;if(e.el){e.el=n.dom.g(e.el),e.pageList=n.dom.query(".bd",e.el),e.width=e.el.offsetWidth,e.height=e.el.offsetHeight,e.setting=k,b=a.mix(b,e.options,!0),e.config=b;var t=Math.min(e.startPage+b.pageStep-1,e.pageCount);E.DocInfo.isApi&&(t=e.pageRange+1),e.pageRange=[e.startPage,t],b.pageRange=e.pageRange,b.shareElId=e.shareElId,k.currentZoomLevel=e.zoomLevel,e.prevStartBtn=n.dom.g("prev-pageList-"+e.uid),e.nextStartBtn=n.dom.g("next-pageList-"+e.uid),e._scrollOfPage=null,e.secondClassify=z.cid3||"",b.bookmark=0===e.bookmark[0]?!1:e.bookmark,e.toPage>1&&e.gotoPage(e.toPage),k.currentPage=e.toPage,e.getPageFromPosition(),setTimeout(function(){n.lang.eventCenter.dispatchEvent("ReaderCreate.after",{reader:window.reader?window.reader:e.reader})},100),y.run($.proxy(this.render,this),$.proxy(this.render,this)),i.xsend(1,100037,{secondClassify:e.secondClassify,pn:e.toPage,out:0}),z&&"cqvip"===z.org_engName?i.xsend(1,100780,{index:1}):z&&1===~~z.hasImage&&-1===z.title.indexOf("\u56fe")&&i.xsend(1,100780,{index:2}),$(window).on("viewyuedurenwurukou",function(){d.getJSON("yuedudaoliu_flow",{success:function(e){0===e.yuedurenwu?$(".yuedurenwu_link").hide():1===e.yuedurenwu&&$(".yuedurenwu_link").show()}})})}},render:function(){var e=this;if(e.toolsBar=new h({readerContainer:e,reader:e.reader,items:e.getToolsBarItems()}),e.fullScreen=new l({readerContainer:e,toolsBar:e.toolsBar,reader:e.reader,status:"disabled"}),n.dom.addClass(e.fullScreen.el,"top-right-fullScreen"),e.el.appendChild(e.fullScreen.el),e.resize(),e.fire("onload"),e.bindEvent(),e.initFromName(),e.toPage>1){var t=new S({toolsBar:e.toolsBar,readerContainer:e});t.render()}e.updateScrollOverflow(),n.lang.eventCenter.dispatchEvent("xreaderResizeRight")},initFromName:function(){var e=this;1!==k.currentZoomLevel&&n.lang.eventCenter.dispatchEvent("Reader.initZoom"),e.nameToSetting()&&k.isFullScreen&&n.lang.eventCenter.dispatchEvent("Reader.initFullScreen")},updateScrollOverflow:function(){var e=n.page.getScrollTop(),t=document.body.scrollHeight,o=n.page.getViewHeight();k.scrollBof=0===e,k.scrollEof=e+o===t},bindEvent:function(){var e=this;n.lang.eventCenter.addEventListener("Reader.zoomChange",n.fn.bind(e.resize,e)),n.lang.eventCenter.addEventListener("Reader.zoomChange",n.fn.bind(e.pageResize,e)),n.lang.eventCenter.addEventListener("InFullScreen.before",n.fn.bind(e.setScrollOfPage,e)),n.lang.eventCenter.addEventListener("OutFullScreen.before",n.fn.bind(e.setScrollOfPage,e)),n.lang.eventCenter.addEventListener("InFullScreen.after",function(){return E.DocInfo.isApi?!1:(e.pageResize(),void e.gotoPage(e._scrollOfPage))}),n.lang.eventCenter.addEventListener("wangpan.doc",function(e,t){t=t||{};var o=t.from||!1;"payDialog"===o?x.getFile():x.start()}),n.lang.eventCenter.addEventListener("OutFullScreen.after",function(){e.pageResize(),e.gotoPage(e._scrollOfPage)});var t=0;n.lang.eventCenter.addEventListener("readMoreBtn.after",function(){0===t&&(e.gotoPage(4),t=1)}),n.lang.eventCenter.addEventListener("Reader.fullScreenResize",function(){e.pageResize(),e.reader.setZoom(e.el.offsetWidth)}),e.reader.addEventListener("firstRender",function(e,t){j.sendPerformanceLog({index:"xreader",item:"firstRender"}),n.lang.eventCenter.dispatchEvent("Reader.firstRender",t)}),e.prevStartBtn&&n.event.on(e.prevStartBtn,"click",function(t){n.event.stop(t);var o=n.event.getTarget(t),r=+n.dom.getAttr(o,"data-prev-page");e.docRefresh(r)}),e.nextStartBtn&&n.event.on(e.nextStartBtn,"click",function(t){n.event.stop(t);var o=n.event.getTarget(t),r=+n.dom.getAttr(o,"data-next-page");e.docRefresh(r)});var o=a.debounce(function(){var t=n.page.getScrollTop();t!==L&&(L=t,e.getPageFromPosition(t))},100);n.event.on(window,"scroll",o),n.on(window,"unload",function(){try{e.reader.dispose()}catch(t){console.log("error")}}),e.showConvert()?e.convertialog():e.wangpanDialog(),$(".reader-end-download").on("click",".reader-download",function(){})},showConvert:function(){return!z.isPaymentDoc&&19!==+z.flag&&"pdf"===z.docType&&"1"!==O.isBGC},insertTopMsg:function(){var e=this;e.inner.appendChild(e.topMsg),n.event.on(e.topMsg,"click",function(){e.scrollToPosition(0,0)}),n.lang.eventCenter.addEventListener("Reader.scroll",function(t,o){o.isOverflow.Bof||(e.topMsg.style.top=n.page.getScrollTop()+"px")})},getPageFromPosition:function(e){var t,o,r,a=this,s=function(e,t){return t>e?-1:1},d=n.dom.getPosition(a.el).top;e=e&&e-d||n.page.getScrollTop()-d,a.createPagesTop(),o=a.pagesTop.concat([]),o.push(e),o.sort(s),t=n.array.indexOf(o,e),0>=t&&(t=1),r=Math.min(t+b.startPage-1,a.pageCount),+k.currentPage!==+r&&(i.xsend(1,100037,{secondClassify:a.secondClassify,pn:r,out:0}),k.currentPage=r),a.updateScrollOverflow(),n.lang.eventCenter.dispatchEvent("Reader.scroll",{currentPage:k.currentPage,top:e,isOverflow:a.isOverflow()})},getToolsBarItems:function(){var e=this,t=[];return t="1"===z.can_dump?[l,c,w,f,m,e.isPrivate?null:C,v,e.showConvert()?u:null,p,_]:[l,c,w,f,m,e.isPrivate?null:C,e.showConvert()?u:null,p,_]},getPage:function(){return k.currentPage},isOverflow:function(){var e=this,t=n.dom.getPosition(e.el).top,o=n.page.getViewHeight(),r=e.el.offsetHeight,i=n.page.getScrollTop(),a=!1,s=!1;return t>=i&&(a=!0),i+o>=t+r&&(s=!0),{Bof:a,Eof:s}},createPagesTop:function(){var e=this,t=n.dom.getPosition,o=t(e.el).top,r=e.pageList,i=r.length,a=0,s=[];for(i;i>a;a++)s.push(t(r[a]).top-o);e.pagesTop=s,b.pagesTop=e.pagesTop},gotoPage:function(e){var t=this;if(E.DocInfo.isApi)return!1;if(!t.pageInRange(e))return void t.docRefresh(e);var o=n.page.getScrollLeft(),r=e%50-1,i=n.dom.getPosition(t.pageList[0>r?49:r]).top+50,a=t.getPageNo();n.lang.eventCenter.dispatchEvent("pageChange.before",{fromPageNo:a,toPageNo:e})&&(t.scrollToPosition(o,i),n.lang.eventCenter.dispatchEvent("pageChange.after",{fromPageNo:a,toPageNo:e}))},pageInRange:function(e){var t=this,o=t.pageRange;return!(e<o[0]||e>o[1])},docRefresh:function(e){var t=this,o=e,n=location.href.replace(/#/g,""),r=location.pathname,i=n.substr(n.indexOf(r)+r.length).indexOf("?"),a=n.indexOf("pn=");return t.setting.currentPage=e,t.settingToName(),1>o&&(o=1),o>b.pageCount&&(o=b.pageCount),-1===i?void(location.href=n+"?pn="+o):-1!==a?void(location.href=n.replace(/pn=\d*/,"pn="+o)):void(location.href=n+"&pn="+o)},settingToName:function(e){var t=this,o={};e=e||{},o.readerSetting=n.object.extend(e,t.setting),window.name=n.json.stringify(o)},nameToSetting:function(){var e=window.name,t={};return e&&-1!==e.search("readerSetting")?(t=n.json.parse(window.name),n.object.extend(k,t.readerSetting),window.name="",!0):void 0},scrollToPosition:function(e,t){window.scrollTo(e,t)},getPageNo:function(){return k.currentPage},prevScreen:function(){var e=n.page.getScrollLeft(),t=n.page.getScrollTop(),o=n.page.getViewHeight();window.scrollTo(e,t-o+140)},nextScreen:function(){var e=n.page.getScrollLeft(),t=n.page.getScrollTop(),o=n.page.getViewHeight();window.scrollTo(e,t+o-140)},resize:function(){var e=this;e.toolsBar.resize({readerWidth:e.el.offsetWidth,bodyElWidth:n.dom.query(b.bodySelector)[0].offsetWidth})},setScrollOfPage:function(){this._scrollOfPage=k.currentPage},pageResize:function(e,t){var o=this;o.pageResizeTimer&&clearTimeout(o.pageResizeTimer),o.pageResizeTimer=setTimeout(function(){o._pageResize(e,t)},15)},_pageResize:function(){try{var e=this,t=e.pageList,o=0,r=t.length,i=n.page.getScrollLeft(),a=n.page.getScrollTop(),s=n.page.getHeight(),d=a/s;for(r;r>o;o++){var g=t[o],c=+parseFloat(n.dom.getAttr(g,"data-mate-width")),l=+parseFloat(n.dom.getAttr(g,"data-mate-height"));"pay-page"!==g.id&&"bottom-download"!==g.id&&"longdoc-login-page"!==g.id&&(g.style.height=g.offsetWidth*l/c+"px")}s=n.page.getHeight(),a=s*d,window.scrollTo(i,a),n.lang.eventCenter.dispatchEvent("Reader.pageResize")}catch(p){console.log("error")}},insert:function(e,t){var o=this,r=n.dom.q("reader-page",o.el,"div"),i=r.length;"undefined"==typeof t&&o.append(e),t-=1,t+1>i&&(t=i),0>t&&(t=0);var a=r[t];n.dom.insertAfter(e,a)},prepend:function(e){var t=this;n.dom.insertBefore(e,t.pageList[0])},append:function(e){var t=this;this.insert(e,t.pageList.length-1)},wangpanDialog:function(){R.get("wangpanTipShow")||$(".wangpan-tip").show(),$(document).on("click",".wangpan-tip .btn-close",function(){$(".wangpan-tip").hide(),R.set("wangpanTipShow",1,{expires:864e5})})},convertialog:function(){var e=this;e.showConvert()&&$(".centerLeft").addClass("convert-wrap-left"),$(".convert-wrap").mouseover(function(){$(".convert-tip").hide(),$(".convert-tool-wrap").show(),R.get("convertTipShow")||R.set("convertTipShow",1,{expires:864e5})}).mouseout(function(){$(".convert-tool-wrap").hide()}).hover(function(){i.xsend(1,102064,{index:1})}),R.get("convertTipShow")||$(".convert-tip").show(),$(document).on("click",".convert-tip .btn-close",function(){$(".convert-tip").hide(),$(".convert-tool-wrap").show(),R.set("convertTipShow",1,{expires:864e5})}),$(document).on("click",".convert-tool-wrap .convert-item",function(){i.xsend(1,102065,{index:1});var e=window.wenkuDatavipInfo;if(O.isLogin)if(e&&e.isVip){window.dataFormatConvert||(window.dataFormatConvert={}),window.dataFormatConvert.docTypeConvert=$(this).data("type"),window.dataFormatConvert.docTypeOrigin=1,window.dataFormatSource="trigger";var t=$.ajax({url:E.Urls.interfaceGetRepeatDown,cache:!1,type:"post",dataType:"json",data:{atype:"getRepeatDown",doc_id:E.DocInfo.docId}});$.when(t).always(function(e){e=200009===parseInt(e.errno,10)?0:parseInt(e,10)||0,2===e||E.UserInfo.isCreater?(z.downloaded=!1,n.lang.eventCenter.dispatchEvent("download.toGetFile")):T.getUserDownloadTicket()})}else window.open("https://wenku.baidu.com/cashier/browse/vipcashier?cashier_code=view_toolbar_convert");else g.login.verlogin(function(){location.reload()})}),$(document).on("click",".convert-tool-wrap .convert-item-other",function(){i.xsend(1,102065,{index:2}),O.isLogin?window.open("/user/browse/huixueconvert"):g.login.verlogin(function(){location.reload()})})}},{type:"html_reader"});(!n.browser.ie||n.browser.ie>7)&&(this.autofixed=new P({el:n.g("fixed-box")})),o.exports.htmlReader=B});